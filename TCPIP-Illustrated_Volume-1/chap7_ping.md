# ICMP协议应用-ping
ping程序主要是为了测试另一台主机是否可达。ICMP回显报文会表明问题所在，并且可以检测IP路由和时间戳选项。

## ping程序ICMP报文格式
<div align=left><img width="500" height="150" src="./images/ICMP请求-应答报文.JPG"/></div>
 
主要字段含义如下：
|字段|含义|
|-|-|
|类型|0表示回显应答（ping 应答），8回显请求（ping 请求）|
|代码|为0|
|标识符|一般设置为发送进程的ID号，方便识别是哪个进程请求服务|
|序号|icmp_seq表示回显请求数量，从0开始，每次加1，以便观察是否丢包|  

## IP路由记录选项
ping程序可以查看IP路由（RR）选项，参数-R可以实现该功能。在路由过程中，每个经过的路由器都会把它的IP地址放入选项字段中（参考[IP报文格式](./chap3_IP-protocol.md/#IP报文格式) ）；当到达目的端后，返回途中经过的路由器也会记录。

由于IP首部中`首部长度`（固定部分20个字节+选项部分）为4 bit，因此最大为60个字节。RR选项占3个字节（ code(1个字节，指明IP选项类型，对于ping为7)+len（1个字节，选项总长度）+ptr（1个字节，指针字段，指向下一个IP地址） ），因此可供存放的IP地址的空间为37个字节，也就不超过9个IP地址。
:warning:  由于最多只能存放9个IP地址，所以记录有限

## IP时间戳选项
和记录路由选项类似，都是在IP首部`选项部分`。时间戳的取值一般为自 UTC午夜开始计的毫秒数，当源主机接收到应答ping包时，将当前时间减去报文中初始时间戳值，即延迟时间（发送请求到应答的时间）




